# Implementation Plan – Q2 Dashboard Finish-up (2025-06-26)

_This file records the agreed next actions for finishing the "Analyst's Funnel" dashboard redesign.  It follows the same style as `docs/analyst_funnel_plan.md` and is meant to be read by humans and ChatGPT alike._

---
## 0  Current Baseline
* Streamlit app runs without traceback on all four pages (Documentation / Experiments Overview / Top 5 / Experiment Analysis).
* Dark theme via `.streamlit/config.toml`.
* Python smoke-test (`scripts/quick_smoke.py`) wired into `dev_watch.py`.
* Trade-Inspector table + KPI cards implemented (Milestone M5-c complete).

---
## 1  High-Priority Deliverables
| ID | Deliverable | Owner | Notes |
|----|-------------|-------|-------|
| **U1** | Headless UI smoke-test (`ui_smoke.py`) + integration into watcher | ChatGPT | Playwright, checks every Streamlit page for `.stException` & 'Traceback' text. |
| **T1** | Theme consolidation (Tailwind palette → Streamlit CSS) | ChatGPT | Replace ad-hoc hexes, inject CSS per mock-up for KPI cards, tables, hover. |
| **V1** | Performance-over-time subplot on Page 1 | ChatGPT | New component `hb_components/performance_time_evolution.py`, switchable by run/algo |
| **C1** | Clean FutureWarnings (`pd.to_numeric(errors="ignore")`) | ChatGPT | Explicit try/except or dtype infer. |

_Nice-to-haves (post-core)_
| ID | Deliverable | Owner | Notes |
|----|-------------|-------|-------|
| **D1** | DCA Analysis Page (Page 4) | ChatGPT | Only visible if run label contains "dca". |
| **T2** | Row-level theme polish (Ag-Grid badges, row highlight) | ChatGPT | Matching Tailwind mock. |
| **U2** | PyTest unit tests for CSV loader + helpers | ChatGPT | Ensure no silent parse issues. |

---
## 2  Execution Sequence (week of 26 Jun 2025)
1. **U1 – UI smoke-test**
   1.1 Add `playwright` to `environment.yml` (`pip:` section).  
   1.2 Script starts Streamlit on a random port, cycles pages, asserts no exceptions.  
   1.3 Integrate into `scripts/dev_watch.py` (after Python smoke).
2. **T1 – Theme sweep**
   2.1 Extend `.streamlit/config.toml` with Tailwind palette.  
   2.2 Create `dashboard/theme_overrides.py` that injects CSS for cards, tables, hover.  
   2.3 Import once from `Home.py` to affect all pages.
3. **V1 – Performance timeline subplot**
   3.1 New helper returns combined figure.  
   3.2 Embed under "Visualisations" on Overview page.
4. **C1 – Warning cleanup**
   4.1 Refactor `_postprocess` numeric coercion.  
   4.2 Replace deprecated behaviour across pages.
5. **Regression pass**
   5.1 Run `dev_watch.py` → quick_smoke → ui_smoke – must be green.  
   5.2 Manual browser spot-check before commit.

### 2a  Full-Profile Visual Polish (approved 2025-06-26)
The following items extend **V1** to fully replicate the Tailwind mock-up in all single-run views (Top-5 expander and Run-Profile page):

* **CSS shell** – `dashboard/theme_overrides.py` injects one style block with `.kpi-card`, `.table-container`, `.chart-container`, `.highlighted-row`, BUY/SELL badge pills.
* **KPI cards** – replace `st.metric` with custom card HTML for colour-coded values.
* **Leaderboard table** – Ag-Grid dark theme with row hover + selected highlight.
* **Backtesting figure upgrades** (`hb_components/backtesting.py`):
  * Always include 3 traces: price (gray), cumulative PNL (dashed orange, secondary y-axis), buy/sell markers (triangles).
  * **Marker sizing** proportional to `filled_amount_quote` (trade size) – linear map  ↦  px radius.
  * Add **4th row subplot**: thin luminescent horizontal bar spanning trade duration (`timestamp` → `close_timestamp`).  Separate row keeps main chart uncluttered.
  * Accept new kwargs `show_duration=True`, `marker_scale=…`.
* **Trade-log table** – badge pills for side, row hover style.
* **Unit test** – load sample detail packet, assert chart has ≥1 buy & sell marker + duration traces.

These tasks will be delivered in Commit 2 of the execution sequence.

---
## 3  Command Cheat-Sheet
```bash
# full cycle (backend + watcher)
export DEBUG_MODE=true            # optional
nohup uvicorn main:app --reload --host 0.0.0.0 --port 8000 \
      > logs/backend.log 2>&1 &
python3 scripts/dev_watch.py      # quick + UI smoke, Streamlit reload
# open http://localhost:8501
```

_If the watcher fails it prints the failing smoke layer and aborts the Streamlit reload._

---
## 4  Success Criteria
* UI smoke-test & quick-smoke both pass automatically after every save.
* KPI cards, leaderboard, charts adopt Tailwind-based dark style.
* Performance timeline visible & interactive on Overview page.
* No FutureWarnings in terminal.

---
_End of plan – file autogenerated by ChatGPT._ 